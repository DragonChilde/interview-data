## 单点登录

- 单点登录: 一处登录多处使用！
- 前提：单点登录多使用在分布式系统中一处登录，处处运行单点登录

![](http://120.77.237.175:9080/photos/eight/program/01.png)

Demo:
参观动物园流程
检票员=认证中心模块

1. 我直接带着大家进动物园，则会被检票员拦住【看我们是否有票】，没有【售票处买票】
   登录=买票
2. 我去买票【带着票，带着大家一起准备进入动物园】 检票员check【有票】
   Token = 票
3. 我们手中有票就可以任意观赏动物园的每处景点
   京东：单点登录，是将 token 放入到 cookie 中
   案例：将浏览器的 cookie 禁用，则在登录京东则失效，无论如何登录不了

------

## 购物车实现过程

购物车：

1. 购物车跟用户的关系 ？

   1. 一个用户必须对应一个购物车【一个用户不管买多少商品，都会存在属于自己的购物车中】
   2. 单点登录一定要在购车前

2. 跟购物车有关的操作有那些？

   - 添加购物车

     -  用户未登录状态

       添加到什么地方，未登录将数据保存到什么地方？

       - Redis —京东
       - Cookie 自己开发项目的时候【如果浏览器禁用Cookie】

     - 用户登录状态

       1. Redis 缓存中 【读写速度快】

          Hash: Hset(key,field,value)

          - Key:user:userId,cart
          - Hset(key,skuId,value);

       2. 存在数据库中 【Oracle，mysql】

   -  展示购物车

     1. 未登录状态显示

        直接从 cookie 中 取得数据展示即可

     2. 登录状态

        用户一旦登录，必须显示数据库【redis】 + cookie 中的购物车的数据

        - Cookie 中有三条记录
        - Redis 中有五条记录
        - 真正展示的时候应该是八条记录

------

## 消息队列在项目中的使用

背景： 在分布式系统中如何处理高并发的
由于在高并发的环境下，来不及同步处理用户发送的请求，则会导致请求发生阻塞，比如说，大量的 insert，update 之类的请求同时到达数据库 MySQL, 直接导致无数的行锁表锁，甚至会导致请求堆积过多，从而触发 too many connections ( 链接数太多 ) 错误，使用消息队列可以解决 【异步通信】

- 异步

  ![](http://120.77.237.175:9080/photos/eight/program/02.png)

- 并行

  ![](http://120.77.237.175:9080/photos/eight/program/03.png)

- 排队

  ![](http://120.77.237.175:9080/photos/eight/program/04.png)

- 消息队列在电商中的使用场景

  ![](http://120.77.237.175:9080/photos/eight/program/05.png)

- 消息队列的弊端

  消息的不确定性： 延迟队列 和 轮询技术来解决问题即可！

  